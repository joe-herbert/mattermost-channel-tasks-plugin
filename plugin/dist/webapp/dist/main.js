(()=>{"use strict";var e={609:e=>{e.exports=window.React},900:function(e,t,o){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},a.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,d)}l((n=n.apply(e,t||[])).next())})},d=this&&this.__generator||function(e,t){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function d(d){return function(l){return function(d){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(i=0)),i;)try{if(o=1,n&&(r=2&d[0]?n.return:d[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,d[1])).done)return r;switch(n=0,r&&(d=[2&d[0],r.value]),d[0]){case 0:case 1:r=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,n=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==d[0]&&2!==d[0])){i=0;continue}if(3===d[0]&&(!r||d[1]>r[0]&&d[1]<r[3])){i.label=d[1];break}if(6===d[0]&&i.label<r[1]){i.label=r[1],r=d;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(d);break}r[2]&&i.ops.pop(),i.trys.pop();continue}d=t.call(e,i)}catch(e){d=[6,e],n=0}finally{o=r=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,l])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=l(o(609)),c=function(){function e(){this.store=null,this.toggleRHSPlugin=null}return e.prototype.initialize=function(e,t){this.store=t;var o=e.registerRightHandSidebarComponent(u,"Channel Todos").toggleRHSPlugin;this.toggleRHSPlugin=o,e.registerChannelHeaderButtonAction(function(){return s.default.createElement("i",{className:"icon icon-check",style:{fontSize:"18px"}})},function(){t.dispatch(o)},"Todo List","Open todo list for this channel"),e.registerChannelHeaderMenuAction("Todo List",function(){t.dispatch(o)},function(){return s.default.createElement("i",{className:"icon icon-check"})})},e.prototype.uninitialize=function(){},e}();t.default=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={todos:[],groups:[],newTodoText:"",newGroupName:"",selectedGroup:"",channelMembers:[],showGroupForm:!1,draggedTodo:null},t.loadTodos=function(){return i(t,void 0,void 0,function(){var e,t,o;return d(this,function(n){switch(n.label){case 0:if(e=this.getChannelId(),console.log("Loading todos for channel:",e),!e)return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(e))];case 2:return[4,n.sent().json()];case 3:return t=n.sent(),this.setState({todos:t.items,groups:t.groups}),[3,5];case 4:return o=n.sent(),console.error("Error loading todos:",o),[3,5];case 5:return[2]}})})},t.loadChannelMembers=function(){return i(t,void 0,void 0,function(){var e,t,o,n,r;return d(this,function(a){switch(a.label){case 0:if(!(e=this.getChannelId()))return[2];a.label=1;case 1:return a.trys.push([1,5,,6]),[4,fetch("/api/v4/channels/".concat(e,"/members"))];case 2:return[4,a.sent().json()];case 3:return t=a.sent(),o=t.map(function(e){return fetch("/api/v4/users/".concat(e.user_id)).then(function(e){return e.json()})}),[4,Promise.all(o)];case 4:return n=a.sent(),this.setState({channelMembers:n}),[3,6];case 5:return r=a.sent(),console.error("Error loading channel members:",r),[3,6];case 6:return[2]}})})},t.addTodo=function(){return i(t,void 0,void 0,function(){var e,t,o,n,r,a,i,l,s;return d(this,function(d){switch(d.label){case 0:if(e=this.state,t=e.newTodoText,o=e.selectedGroup,n=this.getChannelId(),console.log("Adding todo:",t,"for channel:",n),!t.trim()||!n)return[2];d.label=1;case 1:return d.trys.push([1,6,,7]),console.log("Sending POST request to add todo"),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,completed:!1,group_id:o||void 0})})];case 2:return r=d.sent(),console.log("Add todo response:",r.status,r.ok),r.ok?(this.setState({newTodoText:""}),this.loadTodos(),[3,5]):[3,3];case 3:return i=(a=console).error,l=["Failed to add todo:"],[4,r.text()];case 4:i.apply(a,l.concat([d.sent()])),d.label=5;case 5:return[3,7];case 6:return s=d.sent(),console.error("Error adding todo:",s),[3,7];case 7:return[2]}})})},t.toggleTodo=function(e){return i(t,void 0,void 0,function(){var t,o;return d(this,function(n){switch(n.label){case 0:if(!(t=this.getChannelId()))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(a({},e),{completed:!e.completed}))})];case 2:return n.sent(),this.loadTodos(),[3,4];case 3:return o=n.sent(),console.error("Error toggling todo:",o),[3,4];case 4:return[2]}})})},t.deleteTodo=function(e){return i(t,void 0,void 0,function(){var t,o;return d(this,function(n){switch(n.label){case 0:if(!(t=this.getChannelId()))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t,"&id=").concat(e),{method:"DELETE"})];case 2:return n.sent(),this.loadTodos(),[3,4];case 3:return o=n.sent(),console.error("Error deleting todo:",o),[3,4];case 4:return[2]}})})},t.updateTodoAssignee=function(e,o){return i(t,void 0,void 0,function(){var t,n;return d(this,function(r){switch(r.label){case 0:if(!(t=this.getChannelId()))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(a({},e),{assignee_id:o}))})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return n=r.sent(),console.error("Error updating assignee:",n),[3,4];case 4:return[2]}})})},t.addGroup=function(){return i(t,void 0,void 0,function(){var e,t,o,n,r,a,i;return d(this,function(d){switch(d.label){case 0:if(e=this.state.newGroupName,t=this.getChannelId(),console.log("Adding group:",e,"for channel:",t),!e.trim()||!t)return[2];d.label=1;case 1:return d.trys.push([1,6,,7]),console.log("Sending POST request to add group"),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/groups?channel_id=".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})];case 2:return o=d.sent(),console.log("Add group response:",o.status,o.ok),o.ok?(this.setState({newGroupName:"",showGroupForm:!1}),this.loadTodos(),[3,5]):[3,3];case 3:return r=(n=console).error,a=["Failed to add group:"],[4,o.text()];case 4:r.apply(n,a.concat([d.sent()])),d.label=5;case 5:return[3,7];case 6:return i=d.sent(),console.error("Error adding group:",i),[3,7];case 7:return[2]}})})},t.deleteGroup=function(e){return i(t,void 0,void 0,function(){var t,o;return d(this,function(n){switch(n.label){case 0:if(!(t=this.getChannelId()))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/groups?channel_id=".concat(t,"&id=").concat(e),{method:"DELETE"})];case 2:return n.sent(),this.loadTodos(),[3,4];case 3:return o=n.sent(),console.error("Error deleting group:",o),[3,4];case 4:return[2]}})})},t.handleDragStart=function(e){console.log("Parent: handleDragStart called for todo:",e.text),setTimeout(function(){t.setState({draggedTodo:e})},0)},t.handleDragEnd=function(){console.log("handleDragEnd - clearing dragged todo"),t.setState({draggedTodo:null})},t.handleDrop=function(e){return i(t,void 0,void 0,function(){var t,o,n,r,i;return d(this,function(d){switch(d.label){case 0:if(t=this.state.draggedTodo,o=this.getChannelId(),console.log("handleDrop called:",{draggedTodo:t,targetGroupId:e,channelId:o}),!t||!o)return console.log("No dragged todo or channel ID"),[2];if((n=t.group_id||null)===e)return console.log("Same group, no update needed"),this.setState({draggedTodo:null}),[2];console.log("Updating todo group from",n,"to",e),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(o),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(a({},t),{group_id:e||void 0}))})];case 2:return(r=d.sent()).ok?(console.log("Todo updated successfully"),this.setState({draggedTodo:null}),this.loadTodos()):console.error("Failed to update todo:",r.status),[3,4];case 3:return i=d.sent(),console.error("Error moving todo:",i),this.setState({draggedTodo:null}),[3,4];case 4:return[2]}})})},t.groupedTodos=function(e){return t.state.todos.filter(function(t){return null===e?!t.group_id:t.group_id===e})},t}return r(t,e),t.prototype.componentDidMount=function(){console.log("TodoSidebar mounted with props:",this.props),this.loadTodos(),this.loadChannelMembers()},t.prototype.componentDidUpdate=function(e){console.log("TodoSidebar updated, props:",this.props),this.getChannelId(e)!==this.getChannelId(this.props)&&(this.loadTodos(),this.loadChannelMembers())},t.prototype.getChannelId=function(e){var t,o,n,r,a;return void 0===e&&(e=this.props),e.channelId||(null===(t=e.channel)||void 0===t?void 0:t.id)||(null===(a=null===(r=null===(n=null===(o=window.store)||void 0===o?void 0:o.getState())||void 0===n?void 0:n.entities)||void 0===r?void 0:r.channels)||void 0===a?void 0:a.currentChannelId)},t.prototype.render=function(){var e=this,t=this.state,o=t.newTodoText,n=t.newGroupName,r=t.selectedGroup,a=t.groups,i=t.channelMembers,d=t.showGroupForm,l=t.draggedTodo;return this.props.channelDisplayName,s.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",padding:"0"}},s.default.createElement("div",{style:{flex:1,overflowY:"auto",padding:"20px"},onDragOver:function(e){e.preventDefault()}},s.default.createElement("div",{style:{marginBottom:"20px"}},s.default.createElement("input",{type:"text",value:o,onChange:function(t){return e.setState({newTodoText:t.target.value})},onKeyPress:function(t){return"Enter"===t.key&&e.addTodo()},placeholder:"Add new todo...",style:{width:"100%",padding:"10px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}}),s.default.createElement("select",{value:r,onChange:function(t){return e.setState({selectedGroup:t.target.value})},style:{width:"100%",padding:"10px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}},s.default.createElement("option",{value:""},"No Group"),a.map(function(e){return s.default.createElement("option",{key:e.id,value:e.id},e.name)})),s.default.createElement("button",{onClick:this.addTodo,style:{width:"100%",padding:"10px",backgroundColor:"#1c58d9",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",fontWeight:600,cursor:"pointer"}},"Add Todo")),s.default.createElement("div",{style:{marginBottom:"20px"}},s.default.createElement("button",{onClick:function(){return e.setState({showGroupForm:!d})},style:{padding:"6px 12px",fontSize:"13px",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer"}},d?"Cancel":"+ Add Group"),d&&s.default.createElement("div",{style:{marginTop:"10px"}},s.default.createElement("input",{type:"text",value:n,onChange:function(t){return e.setState({newGroupName:t.target.value})},onKeyPress:function(t){return"Enter"===t.key&&e.addGroup()},placeholder:"Group name...",style:{width:"100%",padding:"8px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px"}}),s.default.createElement("button",{onClick:this.addGroup,style:{width:"100%",padding:"8px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",fontSize:"13px",cursor:"pointer"}},"Create Group"))),s.default.createElement(p,{title:"Ungrouped",groupId:null,todos:this.groupedTodos(null),channelMembers:i,onToggle:this.toggleTodo,onDelete:this.deleteTodo,onUpdateAssignee:this.updateTodoAssignee,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDrop:this.handleDrop,isDragging:!!l}),a.map(function(t){return s.default.createElement(p,{key:t.id,title:t.name,groupId:t.id,todos:e.groupedTodos(t.id),channelMembers:i,onToggle:e.toggleTodo,onDelete:e.deleteTodo,onUpdateAssignee:e.updateTodoAssignee,onDeleteGroup:function(){return e.deleteGroup(t.id)},onDragStart:e.handleDragStart,onDragEnd:e.handleDragEnd,onDrop:e.handleDrop,isDragging:!!l})}),0===this.state.todos.length&&s.default.createElement("div",{style:{textAlign:"center",padding:"40px 20px",color:"#888"}},"No todos yet. Add one above to get started!")))},t}(s.default.Component),p=function(e){var t=e.title,o=e.groupId,n=e.todos,r=e.channelMembers,a=e.onToggle,i=e.onDelete,d=e.onUpdateAssignee,l=e.onDeleteGroup,c=e.onDragStart,u=e.onDragEnd,p=e.onDrop,f=e.isDragging,h=s.default.useState(!1),m=h[0],v=h[1];s.default.useEffect(function(){f||v(!1)},[f]);var x=null===o,y=n.length>0;if(!(x||y||f||void 0!==l))return null;var b=f&&0===n.length;return y||b?s.default.createElement("div",{style:{marginBottom:"20px",minHeight:b?"80px":"auto",backgroundColor:m?"#f0f8ff":b?"#fafafa":"transparent",border:m?"2px dashed #1c58d9":b?"2px dashed #ddd":"none",borderRadius:"8px",padding:"12px",transition:"all 0.2s ease",position:"relative"},onDragOver:function(e){console.log("Drag over group:",t),e.preventDefault(),e.dataTransfer.dropEffect="move",v(!0)},onDragLeave:function(e){var t=e.currentTarget,o=e.relatedTarget;o&&t.contains(o)||v(!1)},onDrop:function(e){e.preventDefault(),e.stopPropagation(),console.log("Drop triggered for group:",t,o),v(!1),p(o)}},s.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:n.length>0?"12px":"0"}},s.default.createElement("h4",{style:{margin:0,fontSize:"13px",fontWeight:600,textTransform:"uppercase",color:"#666",letterSpacing:"0.5px"}},t),l&&s.default.createElement("button",{onClick:l,style:{padding:"4px 8px",fontSize:"11px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"}},"Delete")),b&&s.default.createElement("div",{style:{padding:"24px",textAlign:"center",color:m?"#1c58d9":"#999",fontSize:"13px",fontStyle:"italic",fontWeight:m?600:400}},m?"Drop to move to ".concat(t):"Drag items here to move to ".concat(t)),n.map(function(e){return s.default.createElement(g,{key:e.id,todo:e,channelMembers:r,onToggle:a,onDelete:i,onUpdateAssignee:d,onDragStart:c,onDragEnd:u})})):s.default.createElement("div",{style:{marginBottom:"20px",minHeight:"60px",borderRadius:"8px",padding:"12px",border:"2px solid transparent",position:"relative",transition:"all 0.2s ease"}},s.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},s.default.createElement("h4",{style:{margin:0,fontSize:"13px",fontWeight:600,textTransform:"uppercase",color:"#666",letterSpacing:"0.5px"}},t),l&&s.default.createElement("button",{onClick:l,style:{padding:"4px 8px",fontSize:"11px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"}},"Delete")))},g=function(e){var t=e.todo,o=e.channelMembers,n=e.onToggle,r=e.onDelete,a=e.onUpdateAssignee,i=e.onDragStart,d=e.onDragEnd,l=s.default.useState(!1),c=l[0],u=l[1];return s.default.createElement("div",{draggable:"true",onDragStart:function(e){console.log("=== DRAG START ==="),console.log("Todo:",t.text,"Group ID:",t.group_id),u(!0),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.dropEffect="move",i(t)},onDrag:function(e){},onDragEnd:function(e){console.log("=== DRAG END ==="),console.log("Todo:",t.text),console.log("Drop effect:",e.dataTransfer.dropEffect),u(!1),d()},onMouseDown:function(e){console.log("Mouse down on todo item, target:",e.target.tagName);var t=e.target;"INPUT"!==t.tagName&&"SELECT"!==t.tagName&&t.tagName},onDragOver:function(e){e.preventDefault(),e.stopPropagation()},style:{padding:"12px",backgroundColor:t.completed?"#f8f9fa":"#fff",borderRadius:"4px",marginBottom:"8px",border:c?"2px dashed #1c58d9":"1px solid #e9ecef",opacity:c?.4:1,cursor:"grab",transition:"opacity 0.2s ease, border 0.2s ease",userSelect:"none"}},s.default.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:"8px"}},s.default.createElement("div",{style:{marginRight:"8px",color:"#999",fontSize:"16px",cursor:"grab",userSelect:"none",lineHeight:"1"},title:"Drag to move between groups"},"⋮⋮"),s.default.createElement("input",{type:"checkbox",checked:t.completed,onChange:function(){return n(t)},onClick:function(e){return e.stopPropagation()},style:{marginRight:"10px",marginTop:"3px",cursor:"pointer",flexShrink:0}}),s.default.createElement("div",{style:{flex:1,textDecoration:t.completed?"line-through":"none",color:t.completed?"#888":"#333",wordBreak:"break-word",fontSize:"14px",lineHeight:"1.5"}},t.text),s.default.createElement("button",{onClick:function(e){e.stopPropagation(),r(t.id)},style:{padding:"4px 8px",fontSize:"16px",color:"#dc3545",background:"none",border:"none",cursor:"pointer",flexShrink:0,marginLeft:"8px"},title:"Delete todo"},"×")),s.default.createElement("select",{value:t.assignee_id||"",onChange:function(e){e.stopPropagation(),a(t,e.target.value)},onClick:function(e){return e.stopPropagation()},style:{width:"100%",padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer"}},s.default.createElement("option",{value:""},"Unassigned"),o.map(function(e){return s.default.createElement("option",{key:e.id,value:e.id},"@",e.username||e.id)})))};window.registerPlugin("com.mattermost.channel-todo",new c)}},t={},o=function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports}(900),n=window;for(var r in o)n[r]=o[r];o.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();