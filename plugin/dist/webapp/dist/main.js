(()=>{"use strict";var e={609:e=>{e.exports=window.React},900:function(e,t,o){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},a.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,d)}l((n=n.apply(e,t||[])).next())})},d=this&&this.__generator||function(e,t){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function d(d){return function(l){return function(d){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(i=0)),i;)try{if(o=1,n&&(r=2&d[0]?n.return:d[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,d[1])).done)return r;switch(n=0,r&&(d=[2&d[0],r.value]),d[0]){case 0:case 1:r=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,n=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==d[0]&&2!==d[0])){i=0;continue}if(3===d[0]&&(!r||d[1]>r[0]&&d[1]<r[3])){i.label=d[1];break}if(6===d[0]&&i.label<r[1]){i.label=r[1],r=d;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(d);break}r[2]&&i.ops.pop(),i.trys.pop();continue}d=t.call(e,i)}catch(e){d=[6,e],n=0}finally{o=r=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,l])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=l(o(609)),u=function(){function e(){this.store=null}return e.prototype.initialize=function(e,t){var o=this;this.store=t,e.registerChannelHeaderButtonAction(function(){return s.default.createElement("i",{className:"icon icon-check",style:{fontSize:"18px"}})},function(){var e,n,r,a,i,d=t.getState(),l=null===(n=null===(e=d.entities)||void 0===e?void 0:e.channels)||void 0===n?void 0:n.currentChannelId,s=null===(i=null===(a=null===(r=d.entities)||void 0===r?void 0:r.channels)||void 0===a?void 0:a.channels)||void 0===i?void 0:i[l];s&&o.showTodoModal(s)},"Todo List","Open todo list for this channel"),e.registerChannelHeaderMenuAction("Todo List",function(e){var n,r,a,i=null===(a=null===(r=null===(n=t.getState().entities)||void 0===n?void 0:n.channels)||void 0===r?void 0:r.channels)||void 0===a?void 0:a[e];i&&o.showTodoModal(i)},function(){return s.default.createElement("i",{className:"icon icon-check"})})},e.prototype.showTodoModal=function(e){var t=document.createElement("div");t.id="todo-modal-root",document.body.appendChild(t);var o=window.React,n=window.ReactDOM;n.render(o.createElement(c,{channel:e,onClose:function(){n.unmountComponentAtNode(t),document.body.removeChild(t)}}),t)},e}();t.default=u;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={todos:[],groups:[],newTodoText:"",newGroupName:"",selectedGroup:"",channelMembers:[],showGroupForm:!1,draggedTodo:null},t.handleEscape=function(e){"Escape"===e.key&&t.props.onClose()},t.loadTodos=function(){return i(t,void 0,void 0,function(){var e,t,o,n;return d(this,function(r){switch(r.label){case 0:if(!(e=null===(n=this.props.channel)||void 0===n?void 0:n.id))return[2];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(e))];case 2:return[4,r.sent().json()];case 3:return t=r.sent(),this.setState({todos:t.items,groups:t.groups}),[3,5];case 4:return o=r.sent(),console.error("Error loading todos:",o),[3,5];case 5:return[2]}})})},t.loadChannelMembers=function(){return i(t,void 0,void 0,function(){var e,t,o,n,r,a;return d(this,function(i){switch(i.label){case 0:if(!(e=null===(a=this.props.channel)||void 0===a?void 0:a.id))return[2];i.label=1;case 1:return i.trys.push([1,5,,6]),[4,fetch("/api/v4/channels/".concat(e,"/members"))];case 2:return[4,i.sent().json()];case 3:return t=i.sent(),o=t.map(function(e){return fetch("/api/v4/users/".concat(e.user_id)).then(function(e){return e.json()})}),[4,Promise.all(o)];case 4:return n=i.sent(),this.setState({channelMembers:n}),[3,6];case 5:return r=i.sent(),console.error("Error loading channel members:",r),[3,6];case 6:return[2]}})})},t.addTodo=function(){return i(t,void 0,void 0,function(){var e,t,o,n,r,a;return d(this,function(i){switch(i.label){case 0:if(e=this.state,t=e.newTodoText,o=e.selectedGroup,n=null===(a=this.props.channel)||void 0===a?void 0:a.id,!t.trim()||!n)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,completed:!1,group_id:o||void 0})})];case 2:return i.sent().ok&&(this.setState({newTodoText:""}),this.loadTodos()),[3,4];case 3:return r=i.sent(),console.error("Error adding todo:",r),[3,4];case 4:return[2]}})})},t.toggleTodo=function(e){return i(t,void 0,void 0,function(){var t,o,n;return d(this,function(r){switch(r.label){case 0:if(!(t=null===(n=this.props.channel)||void 0===n?void 0:n.id))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(a({},e),{completed:!e.completed}))})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return o=r.sent(),console.error("Error toggling todo:",o),[3,4];case 4:return[2]}})})},t.deleteTodo=function(e){return i(t,void 0,void 0,function(){var t,o,n;return d(this,function(r){switch(r.label){case 0:if(!(t=null===(n=this.props.channel)||void 0===n?void 0:n.id))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t,"&id=").concat(e),{method:"DELETE"})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return o=r.sent(),console.error("Error deleting todo:",o),[3,4];case 4:return[2]}})})},t.updateTodoAssignee=function(e,o){return i(t,void 0,void 0,function(){var t,n,r;return d(this,function(i){switch(i.label){case 0:if(!(t=null===(r=this.props.channel)||void 0===r?void 0:r.id))return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(a({},e),{assignee_id:o}))})];case 2:return i.sent(),this.loadTodos(),[3,4];case 3:return n=i.sent(),console.error("Error updating assignee:",n),[3,4];case 4:return[2]}})})},t.addGroup=function(){return i(t,void 0,void 0,function(){var e,t,o,n;return d(this,function(r){switch(r.label){case 0:if(e=this.state.newGroupName,t=null===(n=this.props.channel)||void 0===n?void 0:n.id,!e.trim()||!t)return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/groups?channel_id=".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})];case 2:return r.sent(),this.setState({newGroupName:"",showGroupForm:!1}),this.loadTodos(),[3,4];case 3:return o=r.sent(),console.error("Error adding group:",o),[3,4];case 4:return[2]}})})},t.deleteGroup=function(e){return i(t,void 0,void 0,function(){var t,o,n;return d(this,function(r){switch(r.label){case 0:if(!(t=null===(n=this.props.channel)||void 0===n?void 0:n.id))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/groups?channel_id=".concat(t,"&id=").concat(e),{method:"DELETE"})];case 2:return r.sent(),this.loadTodos(),[3,4];case 3:return o=r.sent(),console.error("Error deleting group:",o),[3,4];case 4:return[2]}})})},t.handleDragStart=function(e){t.setState({draggedTodo:e})},t.handleDragEnd=function(){t.setState({draggedTodo:null})},t.handleDrop=function(e){return i(t,void 0,void 0,function(){var t,o,n,r,i,l;return d(this,function(d){switch(d.label){case 0:if(t=this.state.draggedTodo,o=null===(l=this.props.channel)||void 0===l?void 0:l.id,console.log("handleDrop called:",{draggedTodo:t,targetGroupId:e,channelId:o}),!t||!o)return console.log("No dragged todo or channel ID"),[2];if((n=t.group_id||null)===e)return console.log("Same group, no update needed"),this.setState({draggedTodo:null}),[2];console.log("Updating todo group from",n,"to",e),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,fetch("/plugins/com.mattermost.channel-todo/api/v1/todos?channel_id=".concat(o),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a(a({},t),{group_id:e||void 0}))})];case 2:return(r=d.sent()).ok?(console.log("Todo updated successfully"),this.setState({draggedTodo:null}),this.loadTodos()):console.error("Failed to update todo:",r.status),[3,4];case 3:return i=d.sent(),console.error("Error moving todo:",i),this.setState({draggedTodo:null}),[3,4];case 4:return[2]}})})},t.groupedTodos=function(e){return t.state.todos.filter(function(t){return null===e?!t.group_id:t.group_id===e})},t}return r(t,e),t.prototype.componentDidMount=function(){this.loadTodos(),this.loadChannelMembers(),document.addEventListener("keydown",this.handleEscape)},t.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.handleEscape)},t.prototype.render=function(){var e,t=this,o=this.state,n=o.newTodoText,r=o.newGroupName,a=o.selectedGroup,i=o.groups,d=o.channelMembers,l=o.showGroupForm,u=o.draggedTodo,c=(null===(e=this.props.channel)||void 0===e?void 0:e.display_name)||"Channel";return s.default.createElement("div",{style:{position:"fixed",top:0,right:0,bottom:0,width:"400px",backgroundColor:"#fff",boxShadow:"-2px 0 8px rgba(0,0,0,0.15)",zIndex:9999,display:"flex",flexDirection:"column"}},s.default.createElement("div",{style:{padding:"16px 20px",borderBottom:"1px solid #ddd",display:"flex",justifyContent:"space-between",alignItems:"center"}},s.default.createElement("div",null,s.default.createElement("h3",{style:{margin:0,fontSize:"18px",fontWeight:600}},"Todo List"),s.default.createElement("div",{style:{fontSize:"12px",color:"#888",marginTop:"4px"}},c)),s.default.createElement("button",{onClick:this.props.onClose,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",padding:"0",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"#666"}},"×")),s.default.createElement("div",{style:{flex:1,overflowY:"auto",padding:"20px"}},s.default.createElement("div",{style:{marginBottom:"20px"}},s.default.createElement("input",{type:"text",value:n,onChange:function(e){return t.setState({newTodoText:e.target.value})},onKeyPress:function(e){return"Enter"===e.key&&t.addTodo()},placeholder:"Add new todo...",style:{width:"100%",padding:"10px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}}),s.default.createElement("select",{value:a,onChange:function(e){return t.setState({selectedGroup:e.target.value})},style:{width:"100%",padding:"10px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"}},s.default.createElement("option",{value:""},"No Group"),i.map(function(e){return s.default.createElement("option",{key:e.id,value:e.id},e.name)})),s.default.createElement("button",{onClick:this.addTodo,style:{width:"100%",padding:"10px",backgroundColor:"#1c58d9",color:"white",border:"none",borderRadius:"4px",fontSize:"14px",fontWeight:600,cursor:"pointer"}},"Add Todo")),s.default.createElement("div",{style:{marginBottom:"20px"}},s.default.createElement("button",{onClick:function(){return t.setState({showGroupForm:!l})},style:{padding:"6px 12px",fontSize:"13px",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer"}},l?"Cancel":"+ Add Group"),l&&s.default.createElement("div",{style:{marginTop:"10px"}},s.default.createElement("input",{type:"text",value:r,onChange:function(e){return t.setState({newGroupName:e.target.value})},onKeyPress:function(e){return"Enter"===e.key&&t.addGroup()},placeholder:"Group name...",style:{width:"100%",padding:"8px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px"}}),s.default.createElement("button",{onClick:this.addGroup,style:{width:"100%",padding:"8px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",fontSize:"13px",cursor:"pointer"}},"Create Group"))),s.default.createElement(p,{title:"Ungrouped",groupId:null,todos:this.groupedTodos(null),channelMembers:d,onToggle:this.toggleTodo,onDelete:this.deleteTodo,onUpdateAssignee:this.updateTodoAssignee,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDrop:this.handleDrop,isDragging:!!u}),i.map(function(e){return s.default.createElement(p,{key:e.id,title:e.name,groupId:e.id,todos:t.groupedTodos(e.id),channelMembers:d,onToggle:t.toggleTodo,onDelete:t.deleteTodo,onUpdateAssignee:t.updateTodoAssignee,onDeleteGroup:function(){return t.deleteGroup(e.id)},onDragStart:t.handleDragStart,onDragEnd:t.handleDragEnd,onDrop:t.handleDrop,isDragging:!!u})}),0===this.state.todos.length&&s.default.createElement("div",{style:{textAlign:"center",padding:"40px 20px",color:"#888"}},"No todos yet. Add one above to get started!")))},t}(s.default.Component),p=function(e){var t=e.title,o=e.groupId,n=e.todos,r=e.channelMembers,a=e.onToggle,i=e.onDelete,d=e.onUpdateAssignee,l=e.onDeleteGroup,u=e.onDragStart,c=e.onDragEnd,p=e.onDrop,g=e.isDragging,h=s.default.useState(!1),m=h[0],v=h[1],x=null===o,y=n.length>0;if(!(x||y||g||void 0!==l))return null;var b=g&&0===n.length;return s.default.createElement("div",{style:{marginBottom:"20px",minHeight:b?"80px":"auto",backgroundColor:m?"#f0f8ff":b?"#fafafa":"transparent",border:m?"2px dashed #1c58d9":b?"2px dashed #ddd":"none",borderRadius:"8px",padding:"12px",transition:"all 0.2s ease",position:"relative"},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),v(!0)},onDragLeave:function(e){var t=e.currentTarget.getBoundingClientRect(),o=e.clientX,n=e.clientY;(o<t.left||o>=t.right||n<t.top||n>=t.bottom)&&v(!1)},onDrop:function(e){e.preventDefault(),e.stopPropagation(),console.log("Drop triggered for group:",t,o),v(!1),p(o)}},s.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:n.length>0?"12px":"0"}},s.default.createElement("h4",{style:{margin:0,fontSize:"13px",fontWeight:600,textTransform:"uppercase",color:"#666",letterSpacing:"0.5px"}},t),l&&s.default.createElement("button",{onClick:l,style:{padding:"4px 8px",fontSize:"11px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"}},"Delete")),b&&s.default.createElement("div",{style:{padding:"24px",textAlign:"center",color:m?"#1c58d9":"#999",fontSize:"13px",fontStyle:"italic",fontWeight:m?600:400}},m?"Drop to move to ".concat(t):"Drag items here to move to ".concat(t)),n.map(function(e){return s.default.createElement(f,{key:e.id,todo:e,channelMembers:r,onToggle:a,onDelete:i,onUpdateAssignee:d,onDragStart:u,onDragEnd:c})}))},f=function(e){var t=e.todo,o=e.channelMembers,n=e.onToggle,r=e.onDelete,a=e.onUpdateAssignee,i=e.onDragStart,d=e.onDragEnd,l=s.default.useState(!1),u=l[0],c=l[1];return s.default.createElement("div",{draggable:"true",onDragStart:function(e){console.log("Drag started for todo:",t.text),e.stopPropagation(),c(!0),i(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id)},onDragEnd:function(e){console.log("Drag ended"),e.stopPropagation(),c(!1),d()},onMouseDown:function(e){console.log("Mouse down on todo item, target:",e.target.tagName);var t=e.target;"INPUT"!==t.tagName&&"SELECT"!==t.tagName&&t.tagName},style:{padding:"12px",backgroundColor:t.completed?"#f8f9fa":"#fff",borderRadius:"4px",marginBottom:"8px",border:u?"2px dashed #1c58d9":"1px solid #e9ecef",opacity:u?.4:1,cursor:"grab",transition:"opacity 0.2s ease, border 0.2s ease",userSelect:"none"}},s.default.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:"8px"}},s.default.createElement("div",{style:{marginRight:"8px",color:"#999",fontSize:"16px",cursor:"grab",userSelect:"none",lineHeight:"1"},title:"Drag to move between groups"},"⋮⋮"),s.default.createElement("input",{type:"checkbox",checked:t.completed,onChange:function(){return n(t)},onClick:function(e){return e.stopPropagation()},style:{marginRight:"10px",marginTop:"3px",cursor:"pointer",flexShrink:0}}),s.default.createElement("div",{style:{flex:1,textDecoration:t.completed?"line-through":"none",color:t.completed?"#888":"#333",wordBreak:"break-word",fontSize:"14px",lineHeight:"1.5"}},t.text),s.default.createElement("button",{onClick:function(e){e.stopPropagation(),r(t.id)},style:{padding:"4px 8px",fontSize:"16px",color:"#dc3545",background:"none",border:"none",cursor:"pointer",flexShrink:0,marginLeft:"8px"},title:"Delete todo"},"×")),s.default.createElement("select",{value:t.assignee_id||"",onChange:function(e){e.stopPropagation(),a(t,e.target.value)},onClick:function(e){return e.stopPropagation()},style:{width:"100%",padding:"6px 8px",fontSize:"12px",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer"}},s.default.createElement("option",{value:""},"Unassigned"),o.map(function(e){return s.default.createElement("option",{key:e.id,value:e.id},"@",e.username||e.id)})))};window.registerPlugin("com.mattermost.channel-todo",new u)}},t={},o=function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports}(900),n=window;for(var r in o)n[r]=o[r];o.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();